<script setup lang="ts">
import { computed, inject, onMounted, ref } from "vue";
import { TABS_INJECTION_KEY } from "./BaseTabs.vue";
import { Primitive, type PrimitiveProps } from "../../Core/primitive";
import { makeContentId, makeTriggerId } from "./utils";
import { BasePresence } from "../BasePresence";
import { BaseTabsContentProps } from "./types";

const props = defineProps<BaseTabsContentProps>();

const context = inject(TABS_INJECTION_KEY);
const triggerId = computed(() => makeTriggerId(context!.baseId, props.value));
const contentId = computed(() => makeContentId(context!.baseId, props.value));

const isSelected = computed(() => props.value === context?.modelValue.value);
const isMountAnimationPreventedRef = ref(isSelected.value);

onMounted(() => {
  requestAnimationFrame(() => (isMountAnimationPreventedRef.value = false));
});

const presenceRef = ref<InstanceType<typeof BasePresence>>();
</script>

<template>
  <BasePresence ref="presenceRef" :present="forceMount || isSelected">
    <Primitive
      :id="contentId"
      :as-child="asChild"
      :as="as"
      role="tabpanel"
      :data-state="isSelected ? 'active' : 'inactive'"
      :data-orientation="context?.orientation.value"
      :aria-labelledby="triggerId"
      :hidden="!presenceRef?.present"
      tabindex="0"
      :style="{
        animationDuration: isMountAnimationPreventedRef ? '0s' : undefined,
      }"
    >
      <slot />
    </Primitive>
  </BasePresence>
</template>
